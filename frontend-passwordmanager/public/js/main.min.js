var form=document.querySelector("#register-form"),loginForm=document.querySelector("#login-form"),createNewApplicationForm=document.querySelector("#create-application"),deleteApplicationForm=document.querySelector("#delete-application"),updateApplicationForm=document.querySelector("#update-application"),createNewPasswordForm=document.querySelector("#create-password"),deletePasswordForm=document.querySelector("#delete-password"),updatePasswordForm=document.querySelector("#update-password");function submitRegisterForm(e){e.preventDefault();var r={},t="";if(form.username.value?r.username=form.username.value:t="you are missing a username",form.hash.value?r.hash=form.hash.value:t+="you are missing a password",t)return displayError(t);fetch("/register",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(r)}).then(function(e){return e.ok?(submitSuccess(e),window.location="/login"):submitError(e)}).catch(submitError)}function submitLoginForm(e){e.preventDefault();var r,t="";if(loginForm.username.value||(t="you are missing a username"),loginForm.hash.value||(t+="you are missing a password"),r={username:loginForm.username.value,hash:loginForm.hash.value},t)return displayError(t);fetch("/login",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(r)}).then(function(e){return e.ok?e.json().then(function(e){localStorage.token=e.token,window.location="/logged?token="+e.token}):submitError(e)}).catch(submitError)}function submitNewApplicationForm(e){e.preventDefault();var r="";if(createNewApplicationForm.newApplication.value||(r="add a name for the application"),r)return displayError(r);var t={newApplication:createNewApplicationForm.newApplication.value};fetch("/users/createapplication",{headers:{"Content-Type":"application/json","x-access-token":localStorage.token},method:"POST",body:JSON.stringify(t)}).then(function(e){return e.ok?window.location="/users/applications?token="+localStorage.token:submitError(e)}).catch(submitError)}function submitdeleteApplicationForm(e){e.preventDefault();var r="";if(deleteApplicationForm.applicationName.value||(r="Missing the application name"),r)return displayError(r);var t={applicationName:deleteApplicationForm.applicationName.value};fetch("/users/deleteapplication",{headers:{"Content-Type":"application/json","x-access-token":localStorage.token},method:"DELETE",body:JSON.stringify(t)}).then(function(e){if(!e.ok)return submitError(e);window.location="/users/applications?token="+localStorage.token}).catch(submitError)}function submitUpdateApplicationForm(e){e.preventDefault();var r="";if(updateApplicationForm.changeName.value||(r="Missing the application name"),r)return displayError(r);var t={applicationName:updateApplicationForm.dataset.id,changeName:updateApplicationForm.changeName.value};fetch("/users/updateapplication",{headers:{"Content-Type":"application/json","x-access-token":localStorage.token},method:"PUT",body:JSON.stringify(t)}).then(function(e){if(!e.ok)return submitError(e);window.location="/users/applications?token="+localStorage.token}).catch(submitError)}function submitNewPasswordForm(e){e.preventDefault();var r="";if(createNewPasswordForm.username.value||(r="missing username \n"),createNewPasswordForm.hash.value||(r+="missing password"),r)return displayError(r);var t=createNewPasswordForm.dataset.appname,o={appName:t,username:createNewPasswordForm.username.value,hash:createNewPasswordForm.hash.value};fetch("/users/createpassword/"+t,{headers:{"Content-Type":"application/json","x-access-token":localStorage.token},method:"POST",body:JSON.stringify(o)}).then(function(e){if(!e.ok)return submitError(e);window.location="/users/applications/?token="+localStorage.token}).catch(submitError)}function submitDeletePasswordForm(e){e.preventDefault();var r="";if(deletePasswordForm.username.value||(r="missing username \n"),deletePasswordForm.hash.value||(r+="missing password"),r)return displayError(r);var t={username:deletePasswordForm.username.value,hash:deletePasswordForm.hash.value},o=deletePasswordForm.dataset.appname,a=deletePasswordForm.dataset.id;fetch("/users/deletepassword/"+o+"/"+a,{headers:{"Content-Type":"application/json","x-access-token":localStorage.token},method:"DELETE",body:JSON.stringify(t)}).then(function(e){if(!e.ok)return submitError(e);window.location="/users/applications?token="+localStorage.token}).catch(submitError)}function submitUpdatePasswordForm(e){e.preventDefault();var r="";if(updatePasswordForm.username.value||(r="missing username \n"),updatePasswordForm.hash.value||(r+="missing password"),r)return displayError(r);var t={username:updatePasswordForm.username.value,hash:updatePasswordForm.hash.value},o=updatePasswordForm.dataset.appname,a=updatePasswordForm.dataset.id;fetch("/users/updatepassword/"+o+"/"+a,{headers:{"Content-Type":"application/json","x-access-token":localStorage.token},method:"PUT",body:JSON.stringify(t)}).then(function(e){if(!e.ok)return submitError(e);window.location="/users/applications?token="+localStorage.token}).catch(submitError)}function submitSuccess(e){if(!e.ok)return submitError(e);form.reset()}function submitError(e,r){return 400<=e.status&&e.status<500?e.text().then(function(e){displayError(e)}):displayError(r||"There was a problem submitting your form. Please try again later.")}function displayError(e){var r=document.querySelector("#error-message");r.textContent=e,r.style.visibility=!0}form&&form.addEventListener("submit",submitRegisterForm),loginForm&&loginForm.addEventListener("submit",submitLoginForm),createNewApplicationForm&&createNewApplicationForm.addEventListener("submit",submitNewApplicationForm),deleteApplicationForm&&deleteApplicationForm.addEventListener("submit",submitdeleteApplicationForm),updateApplicationForm&&updateApplicationForm.addEventListener("submit",submitUpdateApplicationForm),createNewPasswordForm&&createNewPasswordForm.addEventListener("submit",submitNewPasswordForm),deletePasswordForm&&deletePasswordForm.addEventListener("submit",submitDeletePasswordForm),updatePasswordForm&&updatePasswordForm.addEventListener("submit",submitUpdatePasswordForm);