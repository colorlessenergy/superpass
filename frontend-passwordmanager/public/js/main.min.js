var form=document.querySelector("#register-form"),loginForm=document.querySelector("#login-form"),createNewApplicationForm=document.querySelector("#create-application"),deleteApplicationForm=document.querySelector("#delete-application"),updateApplicationForm=document.querySelector("#update-application"),createNewPasswordForm=document.querySelector("#create-password"),deletePasswordForm=document.querySelector("#delete-password"),updatePasswordForm=document.querySelector("#update-password");function submitRegisterForm(e){e.preventDefault();var o,t={};if(alert(form.hash.value),alert(form.username.value),form.username.value?t.username=form.username.value:o="you are missing a username",form.hash.value?t.hash=form.hash.value:o+="you are missing a password",o)return displayError(o);fetch("/register",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(t)}).then(function(e){submitSuccess(e),window.location="/login"}).catch(submitError)}function submitLoginForm(e){e.preventDefault();var o,t;if(loginForm.username.value||(t="you are missing a username"),loginForm.hash.value||(t+="you are missing a password"),o={username:loginForm.username.value,hash:loginForm.hash.value},console.log(o,"LOGIN"),t)return displayError(t);fetch("/login",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(o)}).then(function(e){return console.log(e,"first chain"),e.ok?e.json().then(function(e){localStorage.token=e.token,window.location="/logged?token="+e.token}):submitError(e)}).catch(submitError)}function submitNewApplicationForm(e){e.preventDefault();var o="";createNewApplicationForm.newApplication.value||(o="add a name for the application"),o&&displayError(o);var t={newApplication:createNewApplicationForm.newApplication.value};fetch("/users/createapplication",{headers:{"Content-Type":"application/json","x-access-token":localStorage.token},method:"POST",body:JSON.stringify(t)}).then(function(e){return e.ok?e.json().then(function(e){window.location="/users/applications?token="+localStorage.token}):submitError(e)}).catch(submitError)}function submitdeleteApplicationForm(e){e.preventDefault();var o="";if(deleteApplicationForm.applicationName.value||(o="Missing the application name"),o)return displayError(o);var t={applicationName:deleteApplicationForm.applicationName.value};fetch("/users/deleteapplication",{headers:{"Content-Type":"application/json","x-access-token":localStorage.token},method:"DELETE",body:JSON.stringify(t)}).then(function(e){if(!e.ok)return submitError(e);console.log(e),window.location="/users/applications?token="+localStorage.token}).catch(submitError)}function submitUpdateApplicationForm(e){e.preventDefault();var o="";if(updateApplicationForm.changeName.value||(o="Missing the application name"),o)return displayError(o);var t={applicationName:updateApplicationForm.dataset.id,changeName:updateApplicationForm.changeName.value};fetch("/users/updateapplication",{headers:{"Content-Type":"application/json","x-access-token":localStorage.token},method:"PUT",body:JSON.stringify(t)}).then(function(e){if(console.log("hello"),!e.ok)return submitError(e);window.location="/users/applications?token="+localStorage.token}).catch(submitError)}function submitNewPasswordForm(e){e.preventDefault();var o="";if(createNewPasswordForm.username.value||(o="missing username \n"),createNewPasswordForm.hash.value||(o+="missing password"),o)return displayError(o);var t=createNewPasswordForm.dataset.appname,r={appName:t,username:createNewPasswordForm.username.value,hash:createNewPasswordForm.hash.value};fetch("/users/createpassword/"+t,{headers:{"Content-Type":"application/json","x-access-token":localStorage.token},method:"POST",body:JSON.stringify(r)}).then(function(e){if(console.log("hello first part of chain"),!e.ok)return submitError(e);console.log("reached"),window.location="/users/applications?token="+localStorage.token}).catch(submitError)}function submitDeletePasswordForm(e){e.preventDefault();var o="";if(deletePasswordForm.username.value||(o="missing username \n"),deletePasswordForm.hash.value||(o+="missing password"),o)return displayError(o);var t={username:deletePasswordForm.username.value,hash:deletePasswordForm.hash.value},r=deletePasswordForm.dataset.appname,a=deletePasswordForm.dataset.id;fetch("/users/deletepassword/"+r+"/"+a,{headers:{"Content-Type":"application/json","x-access-token":localStorage.token},method:"DELETE",body:JSON.stringify(t)}).then(function(e){if(!e.ok)return submitError(e);console.log(e),window.location="/users/applications?token="+localStorage.token}).catch(submitError)}function submitUpdatePasswordForm(e){e.preventDefault();var o="";if(updatePasswordForm.username.value||(o="missing username \n"),updatePasswordForm.hash.value||(o+="missing password"),o)return displayError(o);var t={username:updatePasswordForm.username.value,hash:updatePasswordForm.hash.value},r=updatePasswordForm.dataset.appname,a=updatePasswordForm.dataset.id;fetch("/users/updatepassword/"+r+"/"+a,{headers:{"Content-Type":"application/json","x-access-token":localStorage.token},method:"PUT",body:JSON.stringify(t)}).then(function(e){if(!e.ok)return submitError(e);console.log(e),window.location="/users/applications?token="+localStorage.token}).catch(submitError)}function submitSuccess(e){if(!e.ok)return submitError(e);alert("ranned"),console.log(e),form.reset()}function submitError(e,o){return 400<=e.status&&e.status<500?e.text().then(function(e){displayError(e)}):displayError(o||"There was a problem submitting your form. Please try again later.")}function displayError(e){var o=document.querySelector("#error-message");o.textContent=e,o.style.visibility=!0}form&&form.addEventListener("submit",submitRegisterForm),loginForm&&loginForm.addEventListener("submit",submitLoginForm),createNewApplicationForm&&createNewApplicationForm.addEventListener("submit",submitNewApplicationForm),deleteApplicationForm&&deleteApplicationForm.addEventListener("submit",submitdeleteApplicationForm),updateApplicationForm&&updateApplicationForm.addEventListener("submit",submitUpdateApplicationForm),createNewPasswordForm&&createNewPasswordForm.addEventListener("submit",submitNewPasswordForm),deletePasswordForm&&deletePasswordForm.addEventListener("submit",submitDeletePasswordForm),updatePasswordForm&&updatePasswordForm.addEventListener("submit",submitUpdatePasswordForm);