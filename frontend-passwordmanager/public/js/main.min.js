var form=document.querySelector("#register-form"),loginForm=document.querySelector("#login-form"),createNewApplicationForm=document.querySelector("#create-application"),deleteApplicationForm=document.querySelector("#delete-application"),updateApplicationForm=document.querySelector("#update-application"),createNewPasswordForm=document.querySelector("#create-password"),deletePasswordForm=document.querySelector("#delete-password"),updatePasswordForm=document.querySelector("#update-password");function submitRegisterForm(e){e.preventDefault();var t,r={};if(form.username.value?r.username=form.username.value:t="you are missing a username",form.hash.value?r.hash=form.hash.value:t+="you are missing a password",t)return displayError(t);fetch("/register",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(r)}).then(function(e){return e.ok?(submitSuccess(e),window.location="/login"):submitError(e)}).catch(submitError)}function submitLoginForm(e){e.preventDefault();var t,r;if(loginForm.username.value||(r="you are missing a username"),loginForm.hash.value||(r+="you are missing a password"),t={username:loginForm.username.value,hash:loginForm.hash.value},r)return displayError(r);fetch("/login",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(t)}).then(function(e){return e.ok?e.json().then(function(e){localStorage.token=e.token,window.location="/logged?token="+e.token}):submitError(e)}).catch(submitError)}function submitNewApplicationForm(e){e.preventDefault();var t="";createNewApplicationForm.newApplication.value||(t="add a name for the application"),t&&displayError(t);var r={newApplication:createNewApplicationForm.newApplication.value};fetch("/users/createapplication",{headers:{"Content-Type":"application/json","x-access-token":localStorage.token},method:"POST",body:JSON.stringify(r)}).then(function(e){return e.ok?e.json().then(function(e){window.location="/users/applications?token="+localStorage.token}):submitError(e)}).catch(submitError)}function submitdeleteApplicationForm(e){e.preventDefault();var t="";if(deleteApplicationForm.applicationName.value||(t="Missing the application name"),t)return displayError(t);var r={applicationName:deleteApplicationForm.applicationName.value};fetch("/users/deleteapplication",{headers:{"Content-Type":"application/json","x-access-token":localStorage.token},method:"DELETE",body:JSON.stringify(r)}).then(function(e){if(!e.ok)return submitError(e);window.location="/users/applications?token="+localStorage.token}).catch(submitError)}function submitUpdateApplicationForm(e){e.preventDefault();var t="";if(updateApplicationForm.changeName.value||(t="Missing the application name"),t)return displayError(t);var r={applicationName:updateApplicationForm.dataset.id,changeName:updateApplicationForm.changeName.value};fetch("/users/updateapplication",{headers:{"Content-Type":"application/json","x-access-token":localStorage.token},method:"PUT",body:JSON.stringify(r)}).then(function(e){if(!e.ok)return submitError(e);window.location="/users/applications?token="+localStorage.token}).catch(submitError)}function submitNewPasswordForm(e){e.preventDefault();var t="";if(createNewPasswordForm.username.value||(t="missing username \n"),createNewPasswordForm.hash.value||(t+="missing password"),t)return displayError(t);var r=createNewPasswordForm.dataset.appname,o={appName:r,username:createNewPasswordForm.username.value,hash:createNewPasswordForm.hash.value};fetch("/users/createpassword/"+r,{headers:{"Content-Type":"application/json","x-access-token":localStorage.token},method:"POST",body:JSON.stringify(o)}).then(function(e){if(!e.ok)return submitError(e);window.location="/users/applications?token="+localStorage.token}).catch(submitError)}function submitDeletePasswordForm(e){e.preventDefault();var t="";if(deletePasswordForm.username.value||(t="missing username \n"),deletePasswordForm.hash.value||(t+="missing password"),t)return displayError(t);var r={username:deletePasswordForm.username.value,hash:deletePasswordForm.hash.value},o=deletePasswordForm.dataset.appname,a=deletePasswordForm.dataset.id;fetch("/users/deletepassword/"+o+"/"+a,{headers:{"Content-Type":"application/json","x-access-token":localStorage.token},method:"DELETE",body:JSON.stringify(r)}).then(function(e){if(!e.ok)return submitError(e);window.location="/users/applications?token="+localStorage.token}).catch(submitError)}function submitUpdatePasswordForm(e){e.preventDefault();var t="";if(updatePasswordForm.username.value||(t="missing username \n"),updatePasswordForm.hash.value||(t+="missing password"),t)return displayError(t);var r={username:updatePasswordForm.username.value,hash:updatePasswordForm.hash.value},o=updatePasswordForm.dataset.appname,a=updatePasswordForm.dataset.id;fetch("/users/updatepassword/"+o+"/"+a,{headers:{"Content-Type":"application/json","x-access-token":localStorage.token},method:"PUT",body:JSON.stringify(r)}).then(function(e){if(!e.ok)return submitError(e);window.location="/users/applications?token="+localStorage.token}).catch(submitError)}function submitSuccess(e){if(!e.ok)return submitError(e);form.reset()}function submitError(e,t){return 400<=e.status&&e.status<500?e.text().then(function(e){displayError(e)}):displayError(t||"There was a problem submitting your form. Please try again later.")}function displayError(e){var t=document.querySelector("#error-message");t.textContent=e,t.style.visibility=!0}form&&form.addEventListener("submit",submitRegisterForm),loginForm&&loginForm.addEventListener("submit",submitLoginForm),createNewApplicationForm&&createNewApplicationForm.addEventListener("submit",submitNewApplicationForm),deleteApplicationForm&&deleteApplicationForm.addEventListener("submit",submitdeleteApplicationForm),updateApplicationForm&&updateApplicationForm.addEventListener("submit",submitUpdateApplicationForm),createNewPasswordForm&&createNewPasswordForm.addEventListener("submit",submitNewPasswordForm),deletePasswordForm&&deletePasswordForm.addEventListener("submit",submitDeletePasswordForm),updatePasswordForm&&updatePasswordForm.addEventListener("submit",submitUpdatePasswordForm);